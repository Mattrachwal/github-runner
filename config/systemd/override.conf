[Service]
User=github-runner
Group=github-runner

# Set per-instance HOME - this overrides systemd's default /home/github-runner
Environment=HOME=/var/lib/github-runner/%i
Environment=USER=github-runner
Environment=LOGNAME=github-runner

# Set working directory to the runner installation, not the HOME
WorkingDirectory=/opt/actions-runner/%i

# Baseline protections
ProtectHome=yes
Environment=GIT_CONFIG_GLOBAL=/dev/null
Environment=GIT_CONFIG_SYSTEM=/dev/null

# CRITICAL: Clear the base ExecStart and replace without -l flag
# The -l flag causes login shell behavior which can override our environment
ExecStart=
ExecStart=/bin/bash -c 'cd /opt/actions-runner/%i && exec ./run.sh --startuptype service'

# Optional: Resource limits (uncomment if needed)
# MemoryMax=4G
# CPUQuota=80%