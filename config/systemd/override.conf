[Service]
User=github-runner
Group=github-runner

Environment=HOME=/var/lib/github-runner/%i
Environment=USER=github-runner
Environment=LOGNAME=github-runner
Environment=XDG_CONFIG_HOME=%h/.config
Environment=XDG_CACHE_HOME=%h/.cache
Environment=XDG_DATA_HOME=%h/.local/share

# Toolcache/temp (adjust if you move toolcache to /var/lib/...)
Environment=RUNNER_TOOL_CACHE=/opt/actions/_tool
Environment=AGENT_TOOLSDIRECTORY=/opt/actions/_tool
Environment=RUNNER_TEMP=/var/lib/github-runner/%i/_temp

WorkingDirectory=/opt/actions-runner/%i

# Allow writes where the runner actually needs them
ReadWritePaths=/var/lib/github-runner /opt/actions-runner /opt/actions/_tool /opt/actions/_temp

# Keep your hardening
NoNewPrivileges=yes
PrivateTmp=yes
ProtectSystem=full
ProtectHome=yes
ProtectControlGroups=yes
ProtectKernelModules=yes
ProtectKernelTunables=yes
LockPersonality=yes
RestrictSUIDSGID=yes
CapabilityBoundingSet=
AmbientCapabilities=

# Clear and set ExecStart (no -l)
ExecStart=
ExecStart=/bin/bash -c 'cd /opt/actions-runner/%i && exec ./run.sh --startuptype service'

TimeoutStartSec=300
TimeoutStopSec=60
